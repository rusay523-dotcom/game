<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–Ø –ö–∞—á–æ–∫ PvP</title>
<style>
body {margin:0; font-family:Arial,sans-serif; background:url('gym_bg.png') center/cover no-repeat; height:100vh; color:white; text-align:center; display:flex; justify-content:center; align-items:center;}
.menu, .game {width:100%; max-width:500px; padding:20px; box-sizing:border-box;}
button {width:100%; padding:12px; margin:10px 0; font-size:18px; border-radius:12px; border:none; cursor:pointer;}
.trainBtn {background:#2196f3; color:white;}
.aiBtn {background:#ff9800; color:white;}
.pvpBtn {background:#e91e63; color:white;}
.hidden {display:none;}
.game img{width:120px; position:absolute; top:40%; transition: transform 0.2s;}
#hero.jump, #enemy.jump { transform: translate(-50%,-55%); }
.stats {margin-top:250px;}
.buttons {position:absolute; bottom:20px; left:50%; transform:translateX(-50%); width:90%; max-width:320px;}
.flash {position:absolute; width:50px; height:50px; border-radius:50%; background:yellow; opacity:0.7; pointer-events:none;}
</style>
</head>
<body>

<div class="menu">
<h1>üí™ –Ø –ö–∞—á–æ–∫</h1>
<button class="trainBtn" onclick="startTraining()">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</button>
<button class="aiBtn" onclick="startPvP_AI()">PvP —Å –ò–ò</button>
<button class="pvpBtn" onclick="startPvP_Player()">PvP –æ–Ω–ª–∞–π–Ω / –¢–æ–ø</button>
</div>

<!-- –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ -->
<div class="game hidden" id="trainingGame">
<h2>üèãÔ∏è‚Äç‚ôÇÔ∏è –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</h2>
<img id="hero" src="hero.png" style="left:50%; transform:translate(-50%,-50%)">
<div class="stats">
üî• –°–∏–ª–∞: <span id="power">1</span><br>
üèÜ –û—á–∫–∏: <span id="points">0</span>
</div>
<button onclick="train()">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
</div>

<!-- PvP —Å –ò–ò -->
<div class="game hidden" id="pvpGame">
<h2>‚öî PvP —Å –ò–ò</h2>
<img id="heroPvP" src="hero.png" style="left:25%; transform:translate(-50%,-50%)">
<img id="enemyPvP" src="enemy.png" style="left:75%; transform:translate(-50%,-50%)">
<div class="stats">
üí™ –°–∏–ª–∞: <span id="playerStr">5</span><br>
‚ù§Ô∏è HP: <span id="playerHP">20</span><br>
‚ö° –õ–æ–≤–∫–æ—Å—Ç—å: <span id="playerAg">3</span><br>
üí™ –í—Ä–∞–≥ —Å–∏–ª–∞: <span id="enemyStr">5</span><br>
‚ù§Ô∏è –í—Ä–∞–≥ HP: <span id="enemyHP">20</span><br>
‚ö° –í—Ä–∞–≥ –ª–æ–≤–∫–æ—Å—Ç—å: <span id="enemyAg">3</span>
</div>
<div class="buttons">
<button onclick="playerMove('attack')">–ê—Ç–∞–∫–∞</button>
<button onclick="playerMove('defend')">–ó–∞—â–∏—Ç–∞</button>
<button onclick="playerMove('energy')">–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫</button>
<button onclick="playerMove('train')">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</button>
</div>
</div>

<!-- PvP –æ–Ω–ª–∞–π–Ω -->
<div class="game hidden" id="pvpPlayerGame">
<h2>‚öî PvP –æ–Ω–ª–∞–π–Ω</h2>
<img id="heroP" src="hero.png" style="left:25%; transform:translate(-50%,-50%)">
<img id="enemyP" src="enemy.png" style="left:75%; transform:translate(-50%,-50%)">
<div class="stats">
üí™ –°–∏–ª–∞: <span id="playerPStr">5</span><br>
‚ù§Ô∏è HP: <span id="playerPHP">20</span><br>
üí™ –í—Ä–∞–≥ —Å–∏–ª–∞: <span id="enemyPStr">5</span><br>
‚ù§Ô∏è –í—Ä–∞–≥ HP: <span id="enemyPHP">20</span>
</div>
<div class="buttons">
<button onclick="playerMoveOnline('attack')">–ê—Ç–∞–∫–∞</button>
<button onclick="playerMoveOnline('defend')">–ó–∞—â–∏—Ç–∞</button>
<button onclick="playerMoveOnline('energy')">–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫</button>
<button onclick="playerMoveOnline('train')">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</button>
</div>
<h3>–¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤</h3>
<ul id="topList"></ul>
</div>

<script>
// –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
function showMenu(){
    document.querySelector('.menu').classList.remove('hidden');
    document.getElementById('trainingGame').classList.add('hidden');
    document.getElementById('pvpGame').classList.add('hidden');
    document.getElementById('pvpPlayerGame').classList.add('hidden');
}

// === –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ ===
let power=1, points=0;
function startTraining(){
    document.querySelector('.menu').classList.add('hidden');
    document.getElementById('trainingGame').classList.remove('hidden');
}
function train(){
    power++; points++;
    document.getElementById('power').textContent=power;
    document.getElementById('points').textContent=points;
    const hero=document.getElementById('hero');
    hero.style.transform='translate(-50%,-55%)';
    setTimeout(()=>hero.style.transform='translate(-50%,-50%)',200);
}

// === PvP —Å –ò–ò ===
let player={hp:20,str:5,ag:3};
let enemy={hp:20,str:5,ag:3};
function startPvP_AI(){ document.querySelector('.menu').classList.add('hidden'); document.getElementById('pvpGame').classList.remove('hidden'); resetPvP(); }
function updateStatsPvP(){ document.getElementById('playerHP').textContent=player.hp; document.getElementById('playerStr').textContent=player.str; document.getElementById('playerAg').textContent=player.ag; document.getElementById('enemyHP').textContent=enemy.hp; document.getElementById('enemyStr').textContent=enemy.str; document.getElementById('enemyAg').textContent=enemy.ag; }
function resetPvP(){ player={hp:20,str:5,ag:3}; enemy={hp:20,str:5,ag:3}; updateStatsPvP(); }
function calculateDamage(attacker,defender){ let base=attacker.str*(0.8+Math.random()*0.4); if(Math.random()*10<defender.ag) base=0; return Math.floor(base); }
function animateJump(id){ const el=document.getElementById(id); el.style.transform='translate(-50%,-55%)'; setTimeout(()=>el.style.transform='translate(-50%,-50%)',200); }
function flashEffect(x,y){ const f=document.createElement("div"); f.style.position="absolute"; f.style.width="50px"; f.style.height="50px"; f.style.borderRadius="50%"; f.style.background="yellow"; f.style.opacity="0.7"; f.style.left=x-25+"px"; f.style.top=y-25+"px"; document.body.appendChild(f); setTimeout(()=>document.body.removeChild(f),200); }
function playerMove(move){ 
    if(move==='attack'){ enemy.hp-=calculateDamage(player,enemy); animateJump('heroPvP'); flashEffect(document.getElementById('enemyPvP').getBoundingClientRect().left+60,document.getElementById('enemyPvP').getBoundingClientRect().top+60);}
    else if(move==='defend'){ player.str+=1; animateJump('heroPvP'); }
    else if(move==='energy'){ player.str+=2; animateJump('heroPvP'); }
    else if(move==='train'){ player.str+=1; player.hp+=1; player.ag+=1; animateJump('heroPvP'); }
    updateStatsPvP(); setTimeout(enemyMovePvP,500); checkWinPvP();
}
function enemyMovePvP(){ let move; if(enemy.hp<=5 && enemy.str<player.str) move=Math.random()<0.7?'energy':'defend'; else if(player.hp<=5) move=Math.random()<0.7?'attack':'train'; else move=Math.random()<0.5?'attack':'train'; if(move==='attack'){ player.hp-=calculateDamage(enemy,player); animateJump('enemyPvP'); flashEffect(document.getElementById('heroPvP').getBoundingClientRect().left+60,document.getElementById('heroPvP').getBoundingClientRect().top+60);} else if(move==='defend') enemy.str+=1; else if(move==='energy') enemy.str+=2; else if(move==='train'){ enemy.str+=1; enemy.hp+=1; } updateStatsPvP(); checkWinPvP(); }
function checkWinPvP(){ if(player.hp<=0){ alert("üò¢ –¢—ã –ø—Ä–æ–∏–≥—Ä–∞–ª!"); showMenu(); } else if(enemy.hp<=0){ alert("üèÜ –ü–æ–±–µ–¥–∞!"); showMenu(); } }

// === PvP –æ–Ω–ª–∞–π–Ω —á–µ—Ä–µ–∑ WebSocket ===
let ws = new WebSocket('ws://localhost:8080');
let playerId = '–ò–≥—Ä–æ–∫_' + Math.floor(Math.random()*1000);
ws.onopen = ()=>console.log("–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–µ—Ä–≤–µ—Ä—É PvP");
ws.onmessage = function(event){ 
    let msg = JSON.parse(event.data);
    if(msg.type==='move'){
        document.getElementById('enemyPHP').textContent = msg.enemy.hp;
        document.getElementById('enemyPStr').textContent = msg.enemy.str;
        animateJump('enemyP');
    }
    else if(msg.type==='top'){
        const ul = document.getElementById('topList'); ul.innerHTML=''; for(let key in msg.data){ const li=document.createElement('li'); li.textContent=`${key}: ${msg.data[key]} –ø–æ–±–µ–¥`; ul.appendChild(li);}
    }
};
function startPvP_Player(){ document.querySelector('.menu').classList.add('hidden'); document.getElementById('pvpPlayerGame').classList.remove('hidden'); }
function playerMoveOnline(move){
    let player={hp: parseInt(document.getElementById('playerPHP').textContent), str: parseInt(document.getElementById('playerPStr').textContent)};
    let enemy={hp: parseInt(document.getElementById('enemyPHP').textContent), str: parseInt(document.getElementById('enemyPStr').textContent)};
    if(move==='attack') enemy.hp -= Math.floor(Math.random()*3+1+player.str*0.5);
    else if(move==='defend') player.str +=1;
    else if(move==='energy') player.str +=2;
    else if(move==='train'){ player.str+=1; player.hp+=1; }
    ws.send(JSON.stringify({type:'move', playerId, player, enemy}));
    document.getElementById('playerPHP').textContent = player.hp;
    document.getElementById('playerPStr').textContent = player.str;
    animateJump('heroP');
    if(enemy.hp<=0){ ws.send(JSON.stringify({type:'win', winner:playerId})); alert("üèÜ –ü–æ–±–µ–¥–∞!"); showMenu(); }
    else if(player.hp<=0){ ws.send(JSON.stringify({type:'win', winner:'enemy'})); alert("üò¢ –¢—ã –ø—Ä–æ–∏–≥—Ä–∞–ª!"); showMenu(); }
}
</script>

</body>
</html>
